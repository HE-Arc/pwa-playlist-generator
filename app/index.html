<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>PWA Playlist Generator</title>
    </head>
    <body>
        <h1>PWA Playlist Generator</h1>
        <input type="file" webkitdirectory>
        <ul id="listing"></ul>
        <audio id="audio-player" controls>
            <source src="" type="audio/wav">
            Your browser does not support the audio element.
        </audio>

        <script>

        let $_audio = document.querySelector('#audio-player');
        let audioData = {};
        
        document.querySelector('input').addEventListener('change', (event) =>
        {
            let output = document.querySelector('#listing');
            let files = event.target.files;
            
            for (let i = 0; i < files.length; i++)
            {
                let filename = files[i].name;

                if (filename.split('.').pop() === 'wav')
                {
                    let reader = new FileReader();
                    reader.onload = function(e)
                    {
                        audioData[filename] = e.target.result;
                        // <a> tag
                        let itemLink = document.createElement('a');
                        itemLink.innerHTML = filename;
                        itemLink.setAttribute('href', '#');
                        itemLink.setAttribute('data-audio', filename);
                        itemLink.setAttribute('class', 'audio-src');

                        // <li> tag
                        let item = document.createElement('li');
                        item.appendChild(itemLink);
                        
                        output.appendChild(item);
                    }
                    reader.readAsDataURL(files[i]);
                }
            }
        });

        document.addEventListener('click', (event) =>
        {
            if (event.target && event.target.classList.contains('audio-src'))
            {
                let filename = event.target.getAttribute('data-audio');
                let data = audioData[filename];

                if (data)
                {
                    $_audio.setAttribute('src', data);                    
                    $_audio.play();
                }
                else
                {
                    alert('No data for this audio file : ' + filename);
                }
            }
        });

        </script>

    </body>
</html>